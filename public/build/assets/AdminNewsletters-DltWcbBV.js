import{a as R}from"./adminPaginationMixin-DN7Wb3ng.js";import{_ as P,c as _,w as i,g as k,r as o,b as l,a as s,t as u,f as d,o as c,d as b,F as A,e as T}from"./app-EL-kggDq.js";const N={name:"SubscriptionDetailsDialog",props:{modelValue:{type:Boolean,default:!1},subscription:{type:Object,default:null},loading:{type:Boolean,default:!1}},emits:["update:modelValue","unsubscribe","resubscribe","close"],methods:{close(){this.$emit("update:modelValue",!1),this.$emit("close")},handleUnsubscribe(){this.$emit("unsubscribe",this.subscription)},handleResubscribe(){this.$emit("resubscribe",this.subscription)},getStatusColor(t){switch(t){case"active":return"success";case"unsubscribed":return"error";default:return"grey"}},formatDateTime(t){return t?new Date(t).toLocaleString():"-"}}},j={class:"d-flex align-center"},I={class:"mb-4"},O={class:"text-body-1"},H=["href"],L={class:"mb-4"},M={class:"text-body-1"},$={class:"mb-4"},q={class:"text-body-2"},G={class:"mb-4"},J={class:"text-body-2"},K={class:"mb-4"},Q={class:"text-body-2"};function W(t,e,r,F,m,a){const g=o("v-icon"),v=o("v-btn"),y=o("v-card-title"),p=o("v-col"),x=o("v-chip"),w=o("v-row"),S=o("v-card-text"),h=o("v-spacer"),D=o("v-card-actions"),f=o("v-card"),C=o("v-dialog");return c(),_(C,{"model-value":r.modelValue,"onUpdate:modelValue":e[0]||(e[0]=V=>t.$emit("update:modelValue",V)),"max-width":"600",scrollable:""},{default:i(()=>[r.subscription?(c(),_(f,{key:0},{default:i(()=>[l(y,{class:"d-flex justify-space-between align-center bg-primary text-white"},{default:i(()=>[s("div",j,[l(g,{icon:"mdi-email",class:"mr-2"}),e[1]||(e[1]=s("span",null,"Subscription Details",-1))]),l(v,{icon:"mdi-close",variant:"text",onClick:a.close,color:"white"},null,8,["onClick"])]),_:1}),l(S,{class:"pa-6"},{default:i(()=>[l(w,null,{default:i(()=>[l(p,{cols:"12"},{default:i(()=>[s("div",I,[e[2]||(e[2]=s("div",{class:"text-caption text-grey mb-1"},"Email",-1)),s("div",O,[s("a",{href:`mailto:${r.subscription.email}`,class:"text-primary text-decoration-none"},u(r.subscription.email),9,H)])])]),_:1}),l(p,{cols:"12",md:"6"},{default:i(()=>[s("div",L,[e[3]||(e[3]=s("div",{class:"text-caption text-grey mb-1"},"Status",-1)),s("div",M,[l(x,{color:a.getStatusColor(r.subscription.status),size:"small"},{default:i(()=>[d(u(r.subscription.status),1)]),_:1},8,["color"])])])]),_:1}),l(p,{cols:"12",md:"6"},{default:i(()=>[s("div",$,[e[4]||(e[4]=s("div",{class:"text-caption text-grey mb-1"},"Subscribed At",-1)),s("div",q,u(a.formatDateTime(r.subscription.subscribed_at)),1)])]),_:1}),r.subscription.unsubscribed_at?(c(),_(p,{key:0,cols:"12",md:"6"},{default:i(()=>[s("div",G,[e[5]||(e[5]=s("div",{class:"text-caption text-grey mb-1"},"Unsubscribed At",-1)),s("div",J,u(a.formatDateTime(r.subscription.unsubscribed_at)),1)])]),_:1})):k("",!0),l(p,{cols:"12",md:"6"},{default:i(()=>[s("div",K,[e[6]||(e[6]=s("div",{class:"text-caption text-grey mb-1"},"Created At",-1)),s("div",Q,u(a.formatDateTime(r.subscription.created_at)),1)])]),_:1})]),_:1})]),_:1}),l(D,{class:"pa-4 bg-grey-lighten-5"},{default:i(()=>[l(h),r.subscription.status==="active"?(c(),_(v,{key:0,color:"error","prepend-icon":"mdi-email-remove",onClick:a.handleUnsubscribe,loading:r.loading},{default:i(()=>[...e[7]||(e[7]=[d(" Unsubscribe ",-1)])]),_:1},8,["onClick","loading"])):(c(),_(v,{key:1,color:"success","prepend-icon":"mdi-email-check",onClick:a.handleResubscribe,loading:r.loading},{default:i(()=>[...e[8]||(e[8]=[d(" Resubscribe ",-1)])]),_:1},8,["onClick","loading"])),l(v,{color:"grey",variant:"text",onClick:a.close},{default:i(()=>[...e[9]||(e[9]=[d("Close",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})):k("",!0)]),_:1},8,["model-value"])}const X=P(N,[["render",W]]),Y={name:"DeleteSubscriptionDialog",props:{modelValue:{type:Boolean,default:!1},subscription:{type:Object,default:null},loading:{type:Boolean,default:!1}},emits:["update:modelValue","delete","close"],methods:{close(){this.$emit("update:modelValue",!1),this.$emit("close")},handleDelete(){this.$emit("delete",this.subscription)}}};function Z(t,e,r,F,m,a){const g=o("v-card-title"),v=o("v-card-text"),y=o("v-spacer"),p=o("v-btn"),x=o("v-card-actions"),w=o("v-card"),S=o("v-dialog");return c(),_(S,{"model-value":r.modelValue,"onUpdate:modelValue":e[0]||(e[0]=h=>t.$emit("update:modelValue",h)),"max-width":"400"},{default:i(()=>[l(w,null,{default:i(()=>[l(g,{class:"text-h6"},{default:i(()=>[...e[1]||(e[1]=[d("Confirm Delete",-1)])]),_:1}),l(v,null,{default:i(()=>{var h;return[e[2]||(e[2]=d(" Are you sure you want to delete the subscription for ",-1)),s("strong",null,u((h=r.subscription)==null?void 0:h.email),1),e[3]||(e[3]=d("? This action cannot be undone. ",-1))]}),_:1}),l(x,null,{default:i(()=>[l(y),l(p,{color:"grey",variant:"text",onClick:a.close,disabled:r.loading},{default:i(()=>[...e[4]||(e[4]=[d("Cancel",-1)])]),_:1},8,["onClick","disabled"]),l(p,{color:"error",onClick:a.handleDelete,loading:r.loading},{default:i(()=>[...e[5]||(e[5]=[d("Delete",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const ee=P(Y,[["render",Z]]),te={components:{SubscriptionDetailsDialog:X,DeleteSubscriptionDialog:ee},mixins:[R],data(){return{subscriptions:[],statusFilter:null,showDialog:!1,selectedSubscription:null,showDeleteDialog:!1,subscriptionToDelete:null,statusOptions:[{title:"Active",value:"active"},{title:"Unsubscribed",value:"unsubscribed"}]}},async mounted(){await this.loadSubscriptions()},methods:{onSort(t){this.handleSort(t),this.loadSubscriptions()},async loadSubscriptions(){try{this.loading=!0;const t=this.buildPaginationParams();this.search&&(t.search=this.search),this.statusFilter&&(t.status=this.statusFilter);const e=await this.$axios.get("/api/v1/newsletters",{params:t,headers:this.getAuthHeaders()});this.subscriptions=e.data.data||[],this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load subscriptions")}finally{this.loading=!1}},async viewSubscription(t){try{const e=await this.$axios.get(`/api/v1/newsletters/${t.id}`,{headers:this.getAuthHeaders()});this.selectedSubscription=e.data,this.showDialog=!0}catch(e){this.handleApiError(e,"Failed to load subscription details")}},closeDialog(){this.showDialog=!1,this.selectedSubscription=null},async unsubscribe(t){try{this.saving=!0,await this.$axios.put(`/api/v1/newsletters/${t.id}`,{status:"unsubscribed"},{headers:this.getAuthHeaders()}),this.showSuccess("Subscription updated successfully"),await this.loadSubscriptions()}catch(e){this.handleApiError(e,"Failed to unsubscribe")}finally{this.saving=!1}},async resubscribe(t){try{this.saving=!0,await this.$axios.put(`/api/v1/newsletters/${t.id}`,{status:"active"},{headers:this.getAuthHeaders()}),this.showSuccess("Subscription reactivated successfully"),await this.loadSubscriptions()}catch(e){this.handleApiError(e,"Failed to resubscribe")}finally{this.saving=!1}},async unsubscribeFromDialog(t){t||(t=this.selectedSubscription),t&&(await this.unsubscribe(t),this.closeDialog())},async resubscribeFromDialog(t){t||(t=this.selectedSubscription),t&&(await this.resubscribe(t),this.closeDialog())},confirmDelete(t){this.subscriptionToDelete=t,this.showDeleteDialog=!0},async deleteSubscription(t){if(t||(t=this.subscriptionToDelete),!!t)try{this.saving=!0,await this.$axios.delete(`/api/v1/newsletters/${t.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Subscription deleted successfully"),this.showDeleteDialog=!1,this.subscriptionToDelete=null,await this.loadSubscriptions()}catch(e){this.handleApiError(e,"Failed to delete subscription")}finally{this.saving=!1}},async exportSubscriptions(){try{const t=await this.$axios.get("/api/v1/newsletters/export/csv",{headers:this.getAuthHeaders(),responseType:"blob"}),e=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=e,r.setAttribute("download",`newsletter_subscriptions_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(r),r.click(),r.remove(),this.showSuccess("Subscriptions exported successfully")}catch(t){this.handleApiError(t,"Failed to export subscriptions")}},getStatusColor(t){switch(t){case"active":return"success";case"unsubscribed":return"error";default:return"grey"}}}},se={class:"d-flex justify-space-between align-center mb-6"},le={class:"text-caption text-grey"},ie={key:0},oe={class:"d-flex align-center"},ne={class:"d-flex align-center"},ae={class:"d-flex align-center"},re={class:"d-flex align-center"},de={class:"d-flex"},ue=["href"],ce={key:0},me={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},be={class:"text-caption text-grey"},pe={key:0},ge={key:0,class:"ml-2"},ve={key:1},fe={key:0,class:"d-flex align-center gap-2"};function he(t,e,r,F,m,a){const g=o("v-btn"),v=o("v-select"),y=o("v-col"),p=o("v-text-field"),x=o("v-row"),w=o("v-card-text"),S=o("v-card"),h=o("v-card-title"),D=o("v-icon"),f=o("v-skeleton-loader"),C=o("v-chip"),V=o("v-table"),E=o("v-pagination"),z=o("SubscriptionDetailsDialog"),B=o("DeleteSubscriptionDialog");return c(),b("div",null,[s("div",se,[e[12]||(e[12]=s("h1",{class:"text-h4"},"Newsletter Subscriptions",-1)),l(g,{color:"primary","prepend-icon":"mdi-download",onClick:a.exportSubscriptions},{default:i(()=>[...e[11]||(e[11]=[d("Export to CSV",-1)])]),_:1},8,["onClick"])]),l(S,{class:"mb-4"},{default:i(()=>[l(w,null,{default:i(()=>[l(x,null,{default:i(()=>[l(y,{cols:"12",md:"3"},{default:i(()=>[l(v,{modelValue:t.perPage,"onUpdate:modelValue":[e[0]||(e[0]=n=>t.perPage=n),t.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(y,{cols:"12",md:"3"},{default:i(()=>[l(v,{modelValue:m.statusFilter,"onUpdate:modelValue":[e[1]||(e[1]=n=>m.statusFilter=n),a.loadSubscriptions],items:m.statusOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(y,{cols:"12",md:"6"},{default:i(()=>[l(p,{modelValue:t.search,"onUpdate:modelValue":[e[2]||(e[2]=n=>t.search=n),a.loadSubscriptions],label:"Search by email","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(S,null,{default:i(()=>[l(h,{class:"d-flex justify-space-between align-center"},{default:i(()=>[e[14]||(e[14]=s("span",null,"Subscriptions",-1)),s("span",le,[e[13]||(e[13]=d(" Total Records: ",-1)),s("strong",null,u(t.pagination.total||0),1),m.subscriptions.length>0?(c(),b("span",ie," | Showing "+u((t.currentPage-1)*t.perPage+1)+" to "+u(Math.min(t.currentPage*t.perPage,t.pagination.total))+" of "+u(t.pagination.total),1)):k("",!0)])]),_:1}),l(w,null,{default:i(()=>[l(V,null,{default:i(()=>[s("thead",null,[s("tr",null,[s("th",{class:"sortable",onClick:e[3]||(e[3]=n=>a.onSort("email"))},[s("div",oe,[e[15]||(e[15]=d(" Email ",-1)),l(D,{icon:t.getSortIcon("email"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[4]||(e[4]=n=>a.onSort("status"))},[s("div",ne,[e[16]||(e[16]=d(" Status ",-1)),l(D,{icon:t.getSortIcon("status"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[5]||(e[5]=n=>a.onSort("subscribed_at"))},[s("div",ae,[e[17]||(e[17]=d(" Subscribed At ",-1)),l(D,{icon:t.getSortIcon("subscribed_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),s("th",{class:"sortable",onClick:e[6]||(e[6]=n=>a.onSort("unsubscribed_at"))},[s("div",re,[e[18]||(e[18]=d(" Unsubscribed At ",-1)),l(D,{icon:t.getSortIcon("unsubscribed_at"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[19]||(e[19]=s("th",null,"Actions",-1))])]),s("tbody",null,[t.loading?(c(),b(A,{key:0},T(5,n=>s("tr",{key:`skeleton-${n}`},[s("td",null,[l(f,{type:"text",width:"200"})]),s("td",null,[l(f,{type:"chip",width:"90",height:"24"})]),s("td",null,[l(f,{type:"text",width:"140"})]),s("td",null,[l(f,{type:"text",width:"140"})]),s("td",null,[s("div",de,[l(f,{type:"button",width:"32",height:"32",class:"mr-1"}),l(f,{type:"button",width:"32",height:"32",class:"mr-1"}),l(f,{type:"button",width:"32",height:"32"})])])])),64)):(c(),b(A,{key:1},[(c(!0),b(A,null,T(m.subscriptions,n=>(c(),b("tr",{key:n.id},[s("td",null,[s("a",{href:`mailto:${n.email}`,class:"text-primary text-decoration-none"},u(n.email),9,ue)]),s("td",null,[l(C,{color:a.getStatusColor(n.status),size:"small"},{default:i(()=>[d(u(n.status),1)]),_:2},1032,["color"])]),s("td",null,u(t.formatDate(n.subscribed_at)),1),s("td",null,u(n.unsubscribed_at?t.formatDate(n.unsubscribed_at):"-"),1),s("td",null,[l(g,{size:"small",icon:"mdi-eye",onClick:U=>a.viewSubscription(n),variant:"text",class:"mr-1",title:"View Details"},null,8,["onClick"]),n.status==="active"?(c(),_(g,{key:0,size:"small",icon:"mdi-email-remove",onClick:U=>a.unsubscribe(n),variant:"text",color:"error",title:"Unsubscribe"},null,8,["onClick"])):(c(),_(g,{key:1,size:"small",icon:"mdi-email-check",onClick:U=>a.resubscribe(n),variant:"text",color:"success",title:"Resubscribe"},null,8,["onClick"])),l(g,{size:"small",icon:"mdi-delete",onClick:U=>a.confirmDelete(n),variant:"text",color:"error",class:"ml-1",title:"Delete"},null,8,["onClick"])])]))),128)),m.subscriptions.length===0?(c(),b("tr",ce,[...e[20]||(e[20]=[s("td",{colspan:"5",class:"text-center py-4"},"No subscriptions found",-1)])])):k("",!0)],64))])]),_:1}),s("div",me,[s("div",be,[m.subscriptions.length>0&&t.pagination.total>0?(c(),b("span",pe,[e[21]||(e[21]=d(" Showing ",-1)),s("strong",null,u((t.currentPage-1)*t.perPage+1),1),e[22]||(e[22]=d(" to ",-1)),s("strong",null,u(Math.min(t.currentPage*t.perPage,t.pagination.total)),1),e[23]||(e[23]=d(" of ",-1)),s("strong",null,u(t.pagination.total.toLocaleString()),1),e[24]||(e[24]=d(" records ",-1)),t.pagination.last_page>1?(c(),b("span",ge," (Page "+u(t.currentPage)+" of "+u(t.pagination.last_page)+") ",1)):k("",!0)])):(c(),b("span",ve," No records found "))]),t.pagination.last_page>1?(c(),b("div",fe,[l(E,{modelValue:t.currentPage,"onUpdate:modelValue":[e[7]||(e[7]=n=>t.currentPage=n),a.loadSubscriptions],length:t.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):k("",!0)])]),_:1})]),_:1}),l(z,{modelValue:m.showDialog,"onUpdate:modelValue":e[8]||(e[8]=n=>m.showDialog=n),subscription:m.selectedSubscription,loading:t.saving,onUnsubscribe:a.unsubscribeFromDialog,onResubscribe:a.resubscribeFromDialog,onClose:a.closeDialog},null,8,["modelValue","subscription","loading","onUnsubscribe","onResubscribe","onClose"]),l(B,{modelValue:m.showDeleteDialog,"onUpdate:modelValue":e[9]||(e[9]=n=>m.showDeleteDialog=n),subscription:m.subscriptionToDelete,loading:t.saving,onDelete:a.deleteSubscription,onClose:e[10]||(e[10]=n=>m.showDeleteDialog=!1)},null,8,["modelValue","subscription","loading","onDelete"])])}const we=P(te,[["render",he],["__scopeId","data-v-71f435cb"]]);export{we as default};
