import{a as Q}from"./adminPaginationMixin-DN7Wb3ng.js";import{_ as H,d as m,a as i,b as l,w as n,f as r,r as p,c as x,g as w,F as _,e as k,t as a,i as R,h as T,o as u,n as K}from"./app-BuUxLUZB.js";const O={mixins:[Q],data(){return{permissions:[],groupedPermissions:{},groups:[],dialog:!1,editingPermission:null,viewMode:"flat",searchQuery:"",selectedGroup:null,newGroup:"",form:{name:"",slug:"",group:"",description:""},rules:{required:t=>!!t||"This field is required"}}},async mounted(){await this.loadGroups(),await this.loadPermissions()},methods:{async loadPermissions(){try{this.loading=!0;const t={};this.searchQuery&&(t.search=this.searchQuery),this.selectedGroup&&(t.group=this.selectedGroup),this.viewMode==="grouped"?t.grouped=!0:(t.page=this.currentPage,t.per_page=this.perPage);const e=await this.$axios.get("/api/v1/permissions",{params:t,headers:this.getAuthHeaders()});if(this.viewMode==="grouped"){let g=e.data;if(e.data&&e.data.data&&(g=e.data.data),!g||typeof g!="object"){console.warn("Invalid permissions response structure:",g),this.groupedPermissions={},this.permissions=[],this.pagination={current_page:1,last_page:1,per_page:0,total:0};return}Array.isArray(g)?(this.groupedPermissions={},g.forEach(y=>{const o=y.group||y.group_name||"general";this.groupedPermissions[o]||(this.groupedPermissions[o]=[]),this.groupedPermissions[o].push(y)})):this.groupedPermissions=g,this.permissions=[],Object.values(this.groupedPermissions).forEach(y=>{Array.isArray(y)?this.permissions.push(...y):console.warn("Invalid group structure:",y)}),this.pagination={current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length}}else e.data.data?(this.permissions=e.data.data||[],this.pagination={current_page:e.data.current_page,last_page:e.data.last_page,per_page:e.data.per_page,total:e.data.total}):(this.permissions=e.data||[],this.pagination={current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length}),this.groupedPermissions={},this.permissions.forEach(g=>{this.groupedPermissions[g.group]||(this.groupedPermissions[g.group]=[]),this.groupedPermissions[g.group].push(g)})}catch(t){this.handleApiError(t,"Failed to load permissions")}finally{this.loading=!1}},async loadGroups(){try{const t=await this.$axios.get("/api/v1/permissions/groups",{headers:this.getAuthHeaders()});t.data&&t.data.length>0?typeof t.data[0]=="string"?this.groups=t.data.map(e=>({name:e,permissions_count:0})):this.groups=t.data:this.groups=[]}catch(t){console.error("Error loading groups:",t),this.groups=[]}},openDialog(t){t?(this.editingPermission=t,this.form={name:t.name,slug:t.slug,group:t.group,description:t.description||""}):(this.editingPermission=null,this.form={name:"",slug:"",group:"",description:""}),this.dialog=!0},closeDialog(){this.dialog=!1,this.editingPermission=null,this.form={name:"",slug:"",group:"",description:""},this.$refs.permissionForm&&this.$refs.permissionForm.resetValidation()},autoGenerateSlugFromName(){!this.form.slug&&this.form.name&&!this.editingPermission&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))},addNewGroup(){if(this.newGroup&&!this.groups.find(t=>t.name===this.newGroup||typeof t=="string"&&t===this.newGroup)){const t=this.newGroup.trim();this.groups.push({name:t,permissions_count:0}),this.form.group=t,this.newGroup=""}},async savePermission(){if(!this.$refs.permissionForm){this.showError("Form reference not found");return}if(this.$refs.permissionForm.validate()){!this.form.slug&&this.form.name&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")),this.saving=!0;try{const t=this.editingPermission?`/api/v1/permissions/${this.editingPermission.id}`:"/api/v1/permissions",e=this.editingPermission?"put":"post",g={name:this.form.name.trim(),slug:this.form.slug?this.form.slug.trim():null,group:this.form.group.trim(),description:this.form.description?this.form.description.trim():null};await this.$axios[e](t,g,{headers:this.getAuthHeaders()}),this.showSuccess(this.editingPermission?"Permission updated successfully":"Permission created successfully"),this.closeDialog(),await this.loadGroups(),await this.loadPermissions()}catch(t){this.handleApiError(t,"Error saving permission")}finally{this.saving=!1}}},async deletePermission(t){if((t.roles_count||0)>0){this.showError("Cannot delete permission that is assigned to roles. Please remove it from all roles first.");return}if(confirm(`Are you sure you want to delete the permission "${t.name}"?`))try{await this.$axios.delete(`/api/v1/permissions/${t.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Permission deleted successfully"),await this.loadPermissions()}catch(e){this.handleApiError(e,"Error deleting permission")}},getGroupColor(t){return{general:"primary",content:"success",users:"info",leads:"warning",careers:"purple",settings:"orange",system:"error"}[t]||"grey"},onPerPageChange(){this.resetPagination(),this.loadPermissions()},onSort(t){this.handleSort(t),this.loadPermissions()},filterByGroup(t){this.selectedGroup===t?this.clearGroupFilter():(this.selectedGroup=t,this.resetPagination(),this.loadPermissions())},clearGroupFilter(){this.selectedGroup=null,this.resetPagination(),this.loadPermissions()}},watch:{viewMode(){this.currentPage=1,this.loadPermissions()}}},J={class:"page-header"},W={class:"d-flex align-center flex-wrap",style:{gap:"8px"}},X={class:"text-caption text-grey"},Y={key:0},Z={key:0},$={key:0,class:"text-center py-8"},ee={class:"text-h6 mb-3"},te={class:"d-flex align-center"},se={class:"d-flex align-center"},ie={class:"d-flex"},le={class:"font-weight-medium"},oe={class:"text-caption text-grey"},ne={class:"d-flex align-center"},re={class:"d-flex align-center"},ae={class:"d-flex align-center"},de={class:"d-flex"},ue={class:"font-weight-medium"},me={class:"text-caption text-grey"},pe={key:0},ge={key:2,class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},fe={class:"text-caption text-grey"},he={key:0},ce={key:0,class:"ml-2"},ve={key:1},ye={key:0,class:"d-flex align-center gap-2"};function Pe(t,e,g,y,o,d){const c=p("v-btn"),S=p("v-select"),z=p("v-col"),V=p("v-text-field"),F=p("v-row"),G=p("v-card-text"),C=p("v-card"),P=p("v-icon"),M=p("v-btn-toggle"),v=p("v-chip"),A=p("v-card-title"),f=p("v-skeleton-loader"),N=p("v-table"),U=p("v-pagination"),D=p("v-list-item"),E=p("v-textarea"),B=p("v-form"),I=p("v-spacer"),j=p("v-card-actions"),q=p("v-dialog");return u(),m("div",null,[i("div",J,[e[18]||(e[18]=i("h1",{class:"text-h4 page-title"},"Permission Management",-1)),l(c,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=s=>d.openDialog(null)),class:"add-button"},{default:n(()=>[...e[17]||(e[17]=[r(" Add New Permission ",-1)])]),_:1})]),l(C,{class:"mb-4"},{default:n(()=>[l(G,null,{default:n(()=>[l(F,null,{default:n(()=>[o.viewMode==="flat"?(u(),x(z,{key:0,cols:"12",md:"4"},{default:n(()=>[l(S,{modelValue:t.perPage,"onUpdate:modelValue":[e[1]||(e[1]=s=>t.perPage=s),d.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1})):w("",!0),l(z,{cols:"12",md:o.viewMode==="flat"?4:6},{default:n(()=>[l(S,{modelValue:o.selectedGroup,"onUpdate:modelValue":[e[2]||(e[2]=s=>o.selectedGroup=s),d.loadPermissions],items:o.groups,"item-title":s=>typeof s=="string"?s:s.name,"item-value":s=>typeof s=="string"?s:s.name,label:"Filter by Group","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","item-title","item-value","onUpdate:modelValue"])]),_:1},8,["md"]),l(z,{cols:"12",md:o.viewMode==="flat"?4:6},{default:n(()=>[l(V,{modelValue:o.searchQuery,"onUpdate:modelValue":[e[3]||(e[3]=s=>o.searchQuery=s),d.loadPermissions],label:"Search permissions","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["md"])]),_:1})]),_:1})]),_:1}),l(C,{class:"mb-4"},{default:n(()=>[l(G,{class:"py-3"},{default:n(()=>[i("div",W,[l(M,{modelValue:o.viewMode,"onUpdate:modelValue":e[4]||(e[4]=s=>o.viewMode=s),mandatory:"",density:"compact",class:"mr-4"},{default:n(()=>[l(c,{value:"flat",size:"small"},{default:n(()=>[l(P,{start:""},{default:n(()=>[...e[19]||(e[19]=[r("mdi-format-list-bulleted",-1)])]),_:1}),e[20]||(e[20]=r(" Flat View ",-1))]),_:1}),l(c,{value:"grouped",size:"small"},{default:n(()=>[l(P,{start:""},{default:n(()=>[...e[21]||(e[21]=[r("mdi-folder",-1)])]),_:1}),e[22]||(e[22]=r(" Grouped View ",-1))]),_:1})]),_:1},8,["modelValue"]),e[24]||(e[24]=i("span",{class:"text-caption text-grey mr-2"},"Filter by Group:",-1)),(u(!0),m(_,null,k(o.groups,s=>(u(),x(v,{key:s.name,color:d.getGroupColor(s.name),size:"small",variant:o.selectedGroup===s.name?"flat":"outlined",class:K([{"font-weight-bold":o.selectedGroup===s.name},"group-filter-chip"]),onClick:b=>d.filterByGroup(s.name),style:{cursor:"pointer"}},{default:n(()=>[r(a(s.name)+" ",1),l(v,{size:"x-small",color:o.selectedGroup===s.name?"white":d.getGroupColor(s.name),variant:"flat",class:"ml-2"},{default:n(()=>[r(a(s.permissions_count||0),1)]),_:2},1032,["color"])]),_:2},1032,["color","variant","class","onClick"]))),128)),o.selectedGroup?(u(),x(v,{key:0,size:"small",color:"grey",variant:"text","prepend-icon":"mdi-close",onClick:d.clearGroupFilter,style:{cursor:"pointer"},class:"ml-2"},{default:n(()=>[...e[23]||(e[23]=[r(" Clear Filter ",-1)])]),_:1},8,["onClick"])):w("",!0)])]),_:1})]),_:1}),l(C,null,{default:n(()=>[l(A,{class:"d-flex justify-space-between align-center"},{default:n(()=>[e[26]||(e[26]=i("span",null,"Permissions",-1)),i("span",X,[e[25]||(e[25]=r(" Total Records: ",-1)),i("strong",null,a(t.pagination.total||0),1),o.permissions.length>0&&o.viewMode==="flat"?(u(),m("span",Y," | Showing "+a((t.currentPage-1)*t.perPage+1)+" to "+a(Math.min(t.currentPage*t.perPage,t.pagination.total))+" of "+a(t.pagination.total),1)):w("",!0)])]),_:1}),l(G,null,{default:n(()=>[o.viewMode==="grouped"?(u(),m("div",Z,[!t.loading&&Object.keys(o.groupedPermissions).length===0?(u(),m("div",$,[l(P,{size:"64",color:"grey-lighten-1",class:"mb-4"},{default:n(()=>[...e[27]||(e[27]=[r("mdi-shield-off",-1)])]),_:1}),e[28]||(e[28]=i("div",{class:"text-h6 text-grey mb-2"},"No permissions found",-1)),e[29]||(e[29]=i("div",{class:"text-caption text-grey"},"Try adjusting your search or filter criteria",-1))])):w("",!0),(u(!0),m(_,null,k(o.groupedPermissions,(s,b)=>(u(),m("div",{key:b,class:"mb-6"},[i("h3",ee,[r(a(b.charAt(0).toUpperCase()+b.slice(1))+" ",1),l(v,{size:"small",color:"primary",variant:"text",class:"ml-2"},{default:n(()=>[r(a(s.length)+" permission"+a(s.length!==1?"s":""),1)]),_:2},1024)]),l(N,null,{default:n(()=>[i("thead",null,[i("tr",null,[i("th",{class:"sortable",onClick:e[5]||(e[5]=h=>d.onSort("name"))},[i("div",te,[e[30]||(e[30]=r(" Name ",-1)),l(P,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),i("th",{class:"sortable",onClick:e[6]||(e[6]=h=>d.onSort("slug"))},[i("div",se,[e[31]||(e[31]=r(" Slug ",-1)),l(P,{icon:t.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[32]||(e[32]=i("th",null,"Description",-1)),e[33]||(e[33]=i("th",null,"Roles",-1)),e[34]||(e[34]=i("th",null,"Actions",-1))])]),i("tbody",null,[t.loading?(u(),m(_,{key:0},k(5,h=>i("tr",{key:`skeleton-grouped-${h}`},[i("td",null,[l(f,{type:"text",width:"150"})]),i("td",null,[l(f,{type:"chip",width:"120",height:"24"})]),i("td",null,[l(f,{type:"text",width:"200"})]),i("td",null,[l(f,{type:"chip",width:"60",height:"24"})]),i("td",null,[i("div",ie,[l(f,{type:"button",width:"32",height:"32",class:"mr-1"}),l(f,{type:"button",width:"32",height:"32"})])])])),64)):(u(!0),m(_,{key:1},k(s,h=>(u(),m("tr",{key:h.id},[i("td",null,[i("div",le,a(h.name),1)]),i("td",null,[l(v,{size:"small",variant:"outlined"},{default:n(()=>[r(a(h.slug),1)]),_:2},1024)]),i("td",null,[i("span",oe,a(h.description||"No description"),1)]),i("td",null,[l(v,{size:"small",color:"info",variant:"text"},{default:n(()=>[r(a(h.roles_count||0)+" role"+a((h.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),i("td",null,[l(c,{size:"small",icon:"mdi-pencil",onClick:L=>d.openDialog(h),variant:"text"},null,8,["onClick"]),l(c,{size:"small",icon:"mdi-delete",onClick:L=>d.deletePermission(h),variant:"text",color:"error",disabled:(h.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128))])]),_:2},1024)]))),128))])):(u(),x(N,{key:1},{default:n(()=>[i("thead",null,[i("tr",null,[i("th",{class:"sortable",onClick:e[7]||(e[7]=s=>d.onSort("name"))},[i("div",ne,[e[35]||(e[35]=r(" Name ",-1)),l(P,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),i("th",{class:"sortable",onClick:e[8]||(e[8]=s=>d.onSort("slug"))},[i("div",re,[e[36]||(e[36]=r(" Slug ",-1)),l(P,{icon:t.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),i("th",{class:"sortable",onClick:e[9]||(e[9]=s=>d.onSort("group"))},[i("div",ae,[e[37]||(e[37]=r(" Group ",-1)),l(P,{icon:t.getSortIcon("group"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[38]||(e[38]=i("th",null,"Description",-1)),e[39]||(e[39]=i("th",null,"Roles",-1)),e[40]||(e[40]=i("th",null,"Actions",-1))])]),i("tbody",null,[t.loading?(u(),m(_,{key:0},k(5,s=>i("tr",{key:`skeleton-flat-${s}`},[i("td",null,[l(f,{type:"text",width:"150"})]),i("td",null,[l(f,{type:"chip",width:"120",height:"24"})]),i("td",null,[l(f,{type:"chip",width:"100",height:"24"})]),i("td",null,[l(f,{type:"text",width:"200"})]),i("td",null,[l(f,{type:"chip",width:"60",height:"24"})]),i("td",null,[i("div",de,[l(f,{type:"button",width:"32",height:"32",class:"mr-1"}),l(f,{type:"button",width:"32",height:"32"})])])])),64)):(u(),m(_,{key:1},[(u(!0),m(_,null,k(o.permissions,s=>(u(),m("tr",{key:s.id},[i("td",null,[i("div",ue,a(s.name),1)]),i("td",null,[l(v,{size:"small",variant:"outlined"},{default:n(()=>[r(a(s.slug),1)]),_:2},1024)]),i("td",null,[l(v,{size:"small",color:d.getGroupColor(s.group)},{default:n(()=>[r(a(s.group),1)]),_:2},1032,["color"])]),i("td",null,[i("span",me,a(s.description||"No description"),1)]),i("td",null,[l(v,{size:"small",color:"info",variant:"text"},{default:n(()=>[r(a(s.roles_count||0)+" role"+a((s.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),i("td",null,[l(c,{size:"small",icon:"mdi-pencil",onClick:b=>d.openDialog(s),variant:"text"},null,8,["onClick"]),l(c,{size:"small",icon:"mdi-delete",onClick:b=>d.deletePermission(s),variant:"text",color:"error",disabled:(s.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128)),o.permissions.length===0?(u(),m("tr",pe,[...e[41]||(e[41]=[i("td",{colspan:"6",class:"text-center py-4"},"No permissions found",-1)])])):w("",!0)],64))])]),_:1})),o.viewMode==="flat"?(u(),m("div",ge,[i("div",fe,[o.permissions.length>0&&t.pagination.total>0?(u(),m("span",he,[e[42]||(e[42]=r(" Showing ",-1)),i("strong",null,a((t.currentPage-1)*t.perPage+1),1),e[43]||(e[43]=r(" to ",-1)),i("strong",null,a(Math.min(t.currentPage*t.perPage,t.pagination.total)),1),e[44]||(e[44]=r(" of ",-1)),i("strong",null,a(t.pagination.total.toLocaleString()),1),e[45]||(e[45]=r(" records ",-1)),t.pagination.last_page>1?(u(),m("span",ce," (Page "+a(t.currentPage)+" of "+a(t.pagination.last_page)+") ",1)):w("",!0)])):(u(),m("span",ve," No records found "))]),t.pagination.last_page>1?(u(),m("div",ye,[l(U,{modelValue:t.currentPage,"onUpdate:modelValue":[e[10]||(e[10]=s=>t.currentPage=s),d.loadPermissions],length:t.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):w("",!0)])):w("",!0)]),_:1})]),_:1}),l(q,{modelValue:o.dialog,"onUpdate:modelValue":e[16]||(e[16]=s=>o.dialog=s),"max-width":"600",persistent:""},{default:n(()=>[l(C,null,{default:n(()=>[l(A,null,{default:n(()=>[r(a(o.editingPermission?"Edit Permission":"Add New Permission"),1)]),_:1}),l(G,null,{default:n(()=>[l(B,{ref:"permissionForm",onSubmit:R(d.savePermission,["prevent"])},{default:n(()=>[l(V,{modelValue:o.form.name,"onUpdate:modelValue":e[11]||(e[11]=s=>o.form.name=s),label:"Permission Name",rules:[o.rules.required],required:"",hint:"Display name for the permission (e.g., 'Manage Pages')","persistent-hint":"",class:"mb-4",onBlur:d.autoGenerateSlugFromName},null,8,["modelValue","rules","onBlur"]),l(V,{modelValue:o.form.slug,"onUpdate:modelValue":e[12]||(e[12]=s=>o.form.slug=s),label:"Slug",hint:"URL-friendly identifier (auto-generated if empty)","persistent-hint":"",class:"mb-4"},null,8,["modelValue"]),l(S,{modelValue:o.form.group,"onUpdate:modelValue":e[14]||(e[14]=s=>o.form.group=s),items:o.groups,"item-title":s=>typeof s=="string"?s:s.name,"item-value":s=>typeof s=="string"?s:s.name,label:"Group",rules:[o.rules.required],required:"",hint:"Category/group for organizing permissions","persistent-hint":"",class:"mb-4"},{"append-item":n(()=>[l(D,null,{default:n(()=>[l(V,{modelValue:o.newGroup,"onUpdate:modelValue":e[13]||(e[13]=s=>o.newGroup=s),label:"Add New Group","prepend-inner-icon":"mdi-plus",variant:"outlined",density:"compact",onKeyup:T(d.addNewGroup,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["modelValue","items","item-title","item-value","rules"]),l(E,{modelValue:o.form.description,"onUpdate:modelValue":e[15]||(e[15]=s=>o.form.description=s),label:"Description",hint:"Brief description of what this permission allows","persistent-hint":"",rows:"2",class:"mb-4"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),l(j,null,{default:n(()=>[l(I),l(c,{onClick:d.closeDialog,variant:"text"},{default:n(()=>[...e[46]||(e[46]=[r("Cancel",-1)])]),_:1},8,["onClick"]),l(c,{onClick:d.savePermission,color:"primary",loading:t.saving},{default:n(()=>[r(a(o.editingPermission?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const be=H(O,[["render",Pe]]);export{be as default};
